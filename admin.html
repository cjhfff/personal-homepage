<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–‡ç« ç®¡ç† - å†™æ–‡ç« </title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #f8f9fa;
      --bg-card: #ffffff;
      --bg-sidebar: #ffffff;
      --text: #1a1a2e;
      --text-secondary: #666;
      --border: #e8e8e8;
      --primary: #6c5ce7;
      --primary-light: #a29bfe;
      --danger: #e74c3c;
      --success: #27ae60;
      --radius: 12px;
      --shadow: 0 2px 12px rgba(0,0,0,0.08);
    }

    body {
      font-family: 'Inter', 'Noto Serif SC', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* ===== Top Bar ===== */
    .topbar {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 0 24px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    .topbar__left { display: flex; align-items: center; gap: 16px; }
    .topbar__logo { font-size: 18px; font-weight: 700; color: var(--primary); text-decoration: none; }
    .topbar__divider { width: 1px; height: 24px; background: var(--border); }
    .topbar__title { font-size: 14px; color: var(--text-secondary); }
    .topbar__actions { display: flex; gap: 10px; }
    .topbar__link {
      font-size: 13px; color: var(--text-secondary); text-decoration: none;
      padding: 6px 12px; border-radius: 6px; transition: all 0.2s;
    }
    .topbar__link:hover { background: var(--bg); color: var(--primary); }

    /* ===== Layout ===== */
    .layout { display: flex; height: calc(100vh - 56px); }

    /* ===== Sidebar ===== */
    .sidebar {
      width: 280px;
      background: var(--bg-card);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }
    .sidebar__header {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .sidebar__title { font-size: 14px; font-weight: 600; }
    .sidebar__count { font-size: 12px; color: var(--text-secondary); background: var(--bg); padding: 2px 8px; border-radius: 10px; }
    .sidebar__list { flex: 1; overflow-y: auto; padding: 8px; }
    .sidebar__item {
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s;
      margin-bottom: 4px;
      border: 2px solid transparent;
    }
    .sidebar__item:hover { background: var(--bg); }
    .sidebar__item--active { background: #f0eeff; border-color: var(--primary); }
    .sidebar__item-title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .sidebar__item-meta { font-size: 12px; color: var(--text-secondary); display: flex; gap: 8px; }
    .sidebar__item-category {
      font-size: 11px;
      padding: 1px 6px;
      border-radius: 4px;
      background: var(--bg);
      color: var(--primary);
    }
    .sidebar__footer { padding: 12px; border-top: 1px solid var(--border); }
    .btn-new {
      width: 100%;
      padding: 10px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-new:hover { background: #5b4bd5; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(108,92,231,0.3); }

    /* ===== Main Editor ===== */
    .editor-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Settings Bar */
    .settings-bar {
      padding: 16px 24px;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      align-items: center;
    }
    .setting-group { display: flex; align-items: center; gap: 8px; }
    .setting-label { font-size: 12px; color: var(--text-secondary); font-weight: 500; white-space: nowrap; }
    .setting-select, .setting-input {
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 13px;
      font-family: inherit;
      background: var(--bg);
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
    }
    .setting-select:focus, .setting-input:focus { border-color: var(--primary); }
    .setting-input--tags { width: 200px; }
    .setting-input--emoji { width: 50px; text-align: center; font-size: 18px; }
    .setting-color {
      width: 28px; height: 28px;
      border-radius: 50%;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.15s;
    }
    .setting-color:hover, .setting-color--active { border-color: var(--text); transform: scale(1.15); }
    .color-picker { display: flex; gap: 6px; align-items: center; }
    .switch-group { display: flex; align-items: center; gap: 6px; }
    .switch {
      width: 36px; height: 20px;
      background: #ccc;
      border-radius: 10px;
      position: relative;
      cursor: pointer;
      transition: background 0.2s;
      border: none;
    }
    .switch::after {
      content: '';
      width: 16px; height: 16px;
      background: #fff;
      border-radius: 50%;
      position: absolute;
      top: 2px; left: 2px;
      transition: transform 0.2s;
    }
    .switch--on { background: var(--primary); }
    .switch--on::after { transform: translateX(16px); }

    /* Title Input */
    .title-input {
      border: none;
      outline: none;
      font-size: 28px;
      font-weight: 700;
      padding: 24px 32px 8px;
      background: transparent;
      font-family: inherit;
      color: var(--text);
      width: 100%;
    }
    .title-input::placeholder { color: #ccc; }

    /* Toolbar */
    .toolbar {
      padding: 8px 32px;
      display: flex;
      gap: 2px;
      flex-wrap: wrap;
      border-bottom: 1px solid var(--border);
      background: var(--bg-card);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .toolbar__btn {
      padding: 6px 10px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: 4px;
      font-size: 14px;
      color: var(--text-secondary);
      transition: all 0.15s;
      line-height: 1;
    }
    .toolbar__btn:hover { background: var(--bg); color: var(--text); }
    .toolbar__btn--active { background: #f0eeff; color: var(--primary); }
    .toolbar__sep { width: 1px; background: var(--border); margin: 2px 6px; }

    /* Rich Text Editor */
    .editor-scroll { flex: 1; min-height: 0; overflow-y: auto; background: var(--bg-card); }
    .rich-editor {
      min-height: 400px;
      padding: 16px 32px 100px;
      outline: none;
      font-size: 16px;
      line-height: 1.8;
      color: var(--text);
      max-width: 800px;
    }
    .rich-editor:empty::before {
      content: 'å¼€å§‹å†™ä½ çš„æ–‡ç« ...';
      color: #ccc;
      pointer-events: none;
    }
    .rich-editor h2 { font-size: 22px; margin: 24px 0 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
    .rich-editor h3 { font-size: 18px; margin: 20px 0 8px; }
    .rich-editor p { margin-bottom: 12px; }
    .rich-editor blockquote {
      border-left: 4px solid var(--primary);
      padding: 12px 16px;
      margin: 16px 0;
      background: #f8f7ff;
      border-radius: 0 8px 8px 0;
      color: var(--text-secondary);
    }
    .rich-editor ul, .rich-editor ol { margin: 12px 0; padding-left: 24px; }
    .rich-editor li { margin-bottom: 4px; }
    .rich-editor pre {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 16px;
      border-radius: 8px;
      margin: 16px 0;
      overflow-x: auto;
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
    }
    .rich-editor code {
      background: #f0eeff;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      color: var(--primary);
    }
    .rich-editor pre code { background: none; padding: 0; color: inherit; }
    .rich-editor img { max-width: 100%; border-radius: 8px; margin: 12px 0; }

    /* Action Buttons */
    .action-bar {
      padding: 12px 24px;
      background: var(--bg-card);
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
      position: relative;
      z-index: 20;
    }
    .action-bar__left { display: flex; gap: 8px; }
    .action-bar__right { display: flex; gap: 8px; }
    .btn {
      padding: 8px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }
    .btn--primary { background: var(--primary); color: #fff; }
    .btn--primary:hover { background: #5b4bd5; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(108,92,231,0.3); }
    .btn--danger { background: transparent; color: var(--danger); border: 1px solid var(--danger); }
    .btn--danger:hover { background: var(--danger); color: #fff; }
    .btn--ghost { background: transparent; color: var(--text-secondary); border: 1px solid var(--border); }
    .btn--ghost:hover { background: var(--bg); color: var(--text); }

    /* Toast Notification */
    .toast {
      position: fixed;
      top: 72px;
      right: 24px;
      padding: 12px 20px;
      background: var(--success);
      color: #fff;
      border-radius: 8px;
      font-size: 14px;
      z-index: 9999;
      transform: translateX(120%);
      transition: transform 0.3s ease;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    .toast--show { transform: translateX(0); }
    .toast--error { background: var(--danger); }

    /* Empty State */
    .empty-state {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
    }
    .empty-state__icon { font-size: 64px; margin-bottom: 16px; opacity: 0.5; }
    .empty-state__text { font-size: 16px; margin-bottom: 24px; }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar { width: 100%; position: fixed; top: 56px; left: -100%; z-index: 50; height: calc(100vh - 56px); transition: left 0.3s; }
      .sidebar--open { left: 0; }
      .settings-bar { padding: 12px 16px; }
      .title-input { padding: 16px; font-size: 22px; }
      .toolbar { padding: 8px 16px; }
      .rich-editor { padding: 16px; }
      .mobile-toggle { display: block !important; }
    }
    .mobile-toggle { display: none; background: none; border: none; font-size: 20px; cursor: pointer; padding: 4px 8px; }
  </style>
</head>
<body>

  <!-- Top Bar -->
  <div class="topbar">
    <div class="topbar__left">
      <button class="mobile-toggle" onclick="toggleSidebar()">&#9776;</button>
      <a href="index.html" class="topbar__logo">Blog.</a>
      <div class="topbar__divider"></div>
      <span class="topbar__title">æ–‡ç« ç®¡ç†</span>
    </div>
    <div class="topbar__actions">
      <a href="index.html" class="topbar__link">&#127968; é¦–é¡µ</a>
      <a href="blog.html" class="topbar__link">&#128221; åšå®¢</a>
    </div>
  </div>

  <!-- Layout -->
  <div class="layout">
    <!-- Sidebar: Article List -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar__header">
        <span class="sidebar__title">å…¨éƒ¨æ–‡ç« </span>
        <span class="sidebar__count" id="article-count">0 ç¯‡</span>
      </div>
      <div class="sidebar__list" id="article-list">
        <!-- ç”± JS ç”Ÿæˆ -->
      </div>
      <div class="sidebar__footer">
        <button class="btn-new" onclick="createNew()">+ å†™æ–°æ–‡ç« </button>
      </div>
    </div>

    <!-- Editor Area -->
    <div class="editor-area" id="editor-area">
      <div class="empty-state" id="empty-state">
        <div class="empty-state__icon">&#9997;&#65039;</div>
        <div class="empty-state__text">é€‰æ‹©ä¸€ç¯‡æ–‡ç« ç¼–è¾‘ï¼Œæˆ–è€…å†™ä¸€ç¯‡æ–°çš„</div>
        <button class="btn btn--primary" onclick="createNew()">+ å†™æ–°æ–‡ç« </button>
      </div>

      <!-- Editor (hidden by default) -->
      <div id="editor-wrapper" style="display:none; flex:1; flex-direction:column; overflow:hidden;">
        <!-- Settings -->
        <div class="settings-bar">
          <div class="setting-group">
            <span class="setting-label">åˆ†ç±»</span>
            <select class="setting-select" id="ed-category">
              <option value="frontend">å‰ç«¯å¼€å‘</option>
              <option value="backend">åç«¯æŠ€æœ¯</option>
              <option value="learning">å­¦ä¹ æ–¹æ³•</option>
              <option value="life">ç”Ÿæ´»éšç¬”</option>
            </select>
          </div>
          <div class="setting-group">
            <span class="setting-label">æ ‡ç­¾</span>
            <input type="text" class="setting-input setting-input--tags" id="ed-tags" placeholder="ç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šHTML, CSS">
          </div>
          <div class="setting-group">
            <span class="setting-label">å›¾æ ‡</span>
            <input type="text" class="setting-input setting-input--emoji" id="ed-emoji" value="ğŸ“">
          </div>
          <div class="setting-group">
            <span class="setting-label">å¡ç‰‡é¢œè‰²</span>
            <div class="color-picker" id="color-picker">
              <div class="setting-color setting-color--active" data-gradient="linear-gradient(135deg, #6c5ce7, #a29bfe)" style="background:linear-gradient(135deg,#6c5ce7,#a29bfe)"></div>
              <div class="setting-color" data-gradient="linear-gradient(135deg, #fd79a8, #e17055)" style="background:linear-gradient(135deg,#fd79a8,#e17055)"></div>
              <div class="setting-color" data-gradient="linear-gradient(135deg, #00cec9, #0984e3)" style="background:linear-gradient(135deg,#00cec9,#0984e3)"></div>
              <div class="setting-color" data-gradient="linear-gradient(135deg, #55efc4, #00b894)" style="background:linear-gradient(135deg,#55efc4,#00b894)"></div>
              <div class="setting-color" data-gradient="linear-gradient(135deg, #e17055, #fdcb6e)" style="background:linear-gradient(135deg,#e17055,#fdcb6e)"></div>
              <div class="setting-color" data-gradient="linear-gradient(135deg, #0984e3, #74b9ff)" style="background:linear-gradient(135deg,#0984e3,#74b9ff)"></div>
            </div>
          </div>
          <div class="switch-group">
            <span class="setting-label">é¦–é¡µæ¨è</span>
            <button class="switch" id="ed-featured" onclick="toggleSwitch(this)"></button>
          </div>
        </div>

        <!-- Title -->
        <input type="text" class="title-input" id="ed-title" placeholder="è¾“å…¥æ–‡ç« æ ‡é¢˜...">

        <!-- Toolbar -->
        <div class="toolbar">
          <button class="toolbar__btn" onclick="fmt('formatBlock','h2')" title="æ ‡é¢˜">H2</button>
          <button class="toolbar__btn" onclick="fmt('formatBlock','h3')" title="å°æ ‡é¢˜">H3</button>
          <button class="toolbar__btn" onclick="fmt('formatBlock','p')" title="æ­£æ–‡">P</button>
          <div class="toolbar__sep"></div>
          <button class="toolbar__btn" onclick="fmt('bold')" title="åŠ ç²—"><b>B</b></button>
          <button class="toolbar__btn" onclick="fmt('italic')" title="æ–œä½“"><i>I</i></button>
          <button class="toolbar__btn" onclick="fmt('strikeThrough')" title="åˆ é™¤çº¿"><s>S</s></button>
          <div class="toolbar__sep"></div>
          <button class="toolbar__btn" onclick="fmt('insertUnorderedList')" title="æ— åºåˆ—è¡¨">&#8226; åˆ—è¡¨</button>
          <button class="toolbar__btn" onclick="fmt('insertOrderedList')" title="æœ‰åºåˆ—è¡¨">1. åˆ—è¡¨</button>
          <div class="toolbar__sep"></div>
          <button class="toolbar__btn" onclick="insertBlockquote()" title="å¼•ç”¨">&#10077; å¼•ç”¨</button>
          <button class="toolbar__btn" onclick="insertCode()" title="ä»£ç å—">&#60;/&#62; ä»£ç </button>
          <button class="toolbar__btn" onclick="insertInlineCode()" title="è¡Œå†…ä»£ç ">`ä»£ç `</button>
          <div class="toolbar__sep"></div>
          <button class="toolbar__btn" onclick="fmt('undo')" title="æ’¤é”€">&#8617; æ’¤é”€</button>
          <button class="toolbar__btn" onclick="fmt('redo')" title="é‡åš">&#8618; é‡åš</button>
        </div>

        <!-- Rich Editor -->
        <div class="editor-scroll">
          <div class="rich-editor" id="ed-content" contenteditable="true"></div>
        </div>

        <!-- Action Bar -->
        <div class="action-bar">
          <div class="action-bar__left">
            <button type="button" class="btn btn--danger" id="btn-delete">åˆ é™¤æ–‡ç« </button>
          </div>
          <div class="action-bar__right">
            <button type="button" class="btn btn--ghost" onclick="previewArticle()">é¢„è§ˆ</button>
            <button type="button" class="btn btn--primary" onclick="saveArticle()">&#10003; å‘å¸ƒä¿å­˜</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Load default articles data -->
  <script src="data/articles.js"></script>

  <script>
    // ===== æ•°æ®ç®¡ç† =====
    const CATEGORY_MAP = {
      frontend: 'å‰ç«¯å¼€å‘',
      backend: 'åç«¯æŠ€æœ¯',
      learning: 'å­¦ä¹ æ–¹æ³•',
      life: 'ç”Ÿæ´»éšç¬”'
    };

    const STORAGE_KEY = 'blog_articles';
    let articles = [];
    let currentId = null;

    // è¯»å–æ–‡ç« åˆ—è¡¨
    function loadArticles() {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        articles = JSON.parse(stored);
      } else if (typeof BLOG_ARTICLES !== 'undefined') {
        // é¦–æ¬¡è®¿é—®ï¼Œä»é»˜è®¤æ•°æ®å¯¼å…¥
        articles = JSON.parse(JSON.stringify(BLOG_ARTICLES));
        saveToStorage();
      }
    }

    // ä¿å­˜åˆ° localStorage
    function saveToStorage() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(articles));
    }

    // è·å–ä¸‹ä¸€ä¸ª ID
    function getNextId() {
      if (!articles.length) return 1;
      return Math.max(...articles.map(a => a.id)) + 1;
    }

    // ===== ä¾§è¾¹æ æ¸²æŸ“ =====
    function renderSidebar() {
      const list = document.getElementById('article-list');
      const count = document.getElementById('article-count');
      count.textContent = articles.length + ' ç¯‡';

      list.innerHTML = articles.map(a => `
        <div class="sidebar__item ${a.id === currentId ? 'sidebar__item--active' : ''}" onclick="selectArticle(${a.id})">
          <div class="sidebar__item-title">${a.emoji || 'ğŸ“'} ${a.title || 'æ— æ ‡é¢˜'}</div>
          <div class="sidebar__item-meta">
            <span class="sidebar__item-category">${a.categoryName || 'æœªåˆ†ç±»'}</span>
            <span>${a.date || ''}</span>
          </div>
        </div>
      `).join('');
    }

    // ===== æ–‡ç« æ“ä½œ =====
    function createNew() {
      const newArticle = {
        id: getNextId(),
        title: '',
        category: 'frontend',
        categoryName: 'å‰ç«¯å¼€å‘',
        date: new Date().toISOString().slice(0, 10),
        readTime: 'çº¦ 5 åˆ†é’Ÿ',
        views: '0',
        excerpt: '',
        tags: [],
        emoji: 'ğŸ“',
        gradient: 'linear-gradient(135deg, #6c5ce7, #a29bfe)',
        featured: false,
        content: ''
      };
      articles.unshift(newArticle);
      saveToStorage();
      selectArticle(newArticle.id);
      renderSidebar();
      showToast('æ–°æ–‡ç« å·²åˆ›å»ºï¼Œå¼€å§‹å†™ä½œå§ï¼');
      // ç§»åŠ¨ç«¯å…³é—­ä¾§è¾¹æ 
      document.getElementById('sidebar').classList.remove('sidebar--open');
    }

    function selectArticle(id) {
      currentId = id;
      const article = articles.find(a => a.id === id);
      if (!article) return;

      // æ˜¾ç¤ºç¼–è¾‘å™¨
      document.getElementById('empty-state').style.display = 'none';
      const wrapper = document.getElementById('editor-wrapper');
      wrapper.style.display = 'flex';

      // å¡«å……å­—æ®µ
      document.getElementById('ed-title').value = article.title || '';
      document.getElementById('ed-category').value = article.category || 'frontend';
      document.getElementById('ed-tags').value = (article.tags || []).join(', ');
      document.getElementById('ed-emoji').value = article.emoji || 'ğŸ“';
      document.getElementById('ed-content').innerHTML = article.content || '';

      // é¢œè‰²é€‰æ‹©
      document.querySelectorAll('.setting-color').forEach(el => {
        el.classList.toggle('setting-color--active', el.dataset.gradient === article.gradient);
      });

      // é¦–é¡µæ¨èå¼€å…³
      const sw = document.getElementById('ed-featured');
      sw.classList.toggle('switch--on', !!article.featured);

      renderSidebar();

      // ç§»åŠ¨ç«¯å…³é—­ä¾§è¾¹æ 
      document.getElementById('sidebar').classList.remove('sidebar--open');
    }

    function saveArticle() {
      if (currentId === null) return;
      const article = articles.find(a => a.id === currentId);
      if (!article) return;

      const title = document.getElementById('ed-title').value.trim();
      const category = document.getElementById('ed-category').value;
      const tags = document.getElementById('ed-tags').value.split(/[,ï¼Œ]/).map(t => t.trim()).filter(Boolean);
      const emoji = document.getElementById('ed-emoji').value.trim() || 'ğŸ“';
      const content = document.getElementById('ed-content').innerHTML;
      const featured = document.getElementById('ed-featured').classList.contains('switch--on');
      const activeColor = document.querySelector('.setting-color--active');
      const gradient = activeColor ? activeColor.dataset.gradient : article.gradient;

      if (!title) {
        showToast('è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜', true);
        document.getElementById('ed-title').focus();
        return;
      }

      article.title = title;
      article.category = category;
      article.categoryName = CATEGORY_MAP[category] || category;
      article.tags = tags;
      article.emoji = emoji;
      article.content = content;
      article.featured = featured;
      article.gradient = gradient;

      // è‡ªåŠ¨ç”Ÿæˆæ‘˜è¦ï¼ˆå–æ­£æ–‡å‰100ä¸ªçº¯æ–‡å­—ï¼‰
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = content;
      const plainText = tempDiv.textContent || '';
      article.excerpt = plainText.substring(0, 100).trim() + (plainText.length > 100 ? '...' : '');

      // è‡ªåŠ¨ä¼°ç®—é˜…è¯»æ—¶é—´
      const wordCount = plainText.length;
      const minutes = Math.max(1, Math.ceil(wordCount / 400));
      article.readTime = `çº¦ ${minutes} åˆ†é’Ÿ`;

      saveToStorage();
      renderSidebar();
      showToast('æ–‡ç« å·²ä¿å­˜å‘å¸ƒï¼');
    }

    function deleteArticle() {
      try {
        var edContent = document.getElementById('ed-content');
        if (edContent && edContent.blur) edContent.blur();

        if (currentId === null) {
          showToast('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æ–‡ç« ', true);
          return;
        }
        var article = articles.find(function(a) { return a.id === currentId; });
        if (!article) {
          showToast('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æ–‡ç« ', true);
          return;
        }
        if (!confirm('ç¡®å®šè¦åˆ é™¤ã€Œ' + (article.title || 'æ— æ ‡é¢˜') + 'ã€å—ï¼Ÿåˆ é™¤åä¸å¯æ¢å¤ã€‚')) return;

        const deletedId = currentId;
        articles = articles.filter(a => a.id !== deletedId);
        currentId = null;
        localStorage.setItem(STORAGE_KEY, JSON.stringify(articles));
        renderSidebar();

        document.getElementById('empty-state').style.display = 'flex';
        document.getElementById('editor-wrapper').style.display = 'none';
        showToast('æ–‡ç« å·²åˆ é™¤');
      } catch (err) {
        showToast('åˆ é™¤å¤±è´¥ï¼š' + (err.message || err), true);
      }
    }

    function previewArticle() {
      if (currentId === null) return;
      // å…ˆä¿å­˜
      saveArticle();
      // æ–°çª—å£æ‰“å¼€é¢„è§ˆ
      window.open(`article.html?id=${currentId}`, '_blank');
    }

    // ===== å¯Œæ–‡æœ¬ç¼–è¾‘ =====
    function fmt(command, value) {
      document.getElementById('ed-content').focus();
      if (command === 'formatBlock') {
        document.execCommand('formatBlock', false, `<${value}>`);
      } else {
        document.execCommand(command, false, value || null);
      }
    }

    function insertBlockquote() {
      document.getElementById('ed-content').focus();
      document.execCommand('formatBlock', false, '<blockquote>');
    }

    function insertCode() {
      const editor = document.getElementById('ed-content');
      editor.focus();
      const selection = window.getSelection();
      const text = selection.toString() || '// åœ¨è¿™é‡Œè¾“å…¥ä»£ç ';
      const pre = document.createElement('pre');
      const code = document.createElement('code');
      code.textContent = text;
      pre.appendChild(code);

      const range = selection.getRangeAt(0);
      range.deleteContents();
      range.insertNode(pre);

      // åœ¨ pre åé¢æ·»åŠ ä¸€ä¸ªç©ºæ®µè½ï¼Œæ–¹ä¾¿ç»§ç»­è¾“å…¥
      const p = document.createElement('p');
      p.innerHTML = '<br>';
      pre.parentNode.insertBefore(p, pre.nextSibling);

      // ç§»åŠ¨å…‰æ ‡åˆ°æ–°æ®µè½
      const newRange = document.createRange();
      newRange.setStart(p, 0);
      newRange.collapse(true);
      selection.removeAllRanges();
      selection.addRange(newRange);
    }

    function insertInlineCode() {
      const selection = window.getSelection();
      const text = selection.toString() || 'ä»£ç ';
      document.execCommand('insertHTML', false, `<code>${text}</code>&nbsp;`);
    }

    // ===== UI è¾…åŠ© =====
    function toggleSwitch(el) {
      el.classList.toggle('switch--on');
    }

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('sidebar--open');
    }

    // é¢œè‰²é€‰æ‹©
    document.getElementById('color-picker').addEventListener('click', (e) => {
      const target = e.target.closest('.setting-color');
      if (!target) return;
      document.querySelectorAll('.setting-color').forEach(el => el.classList.remove('setting-color--active'));
      target.classList.add('setting-color--active');
    });

    // Toast æç¤º
    function showToast(msg, isError) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.className = 'toast toast--show' + (isError ? ' toast--error' : '');
      setTimeout(() => { toast.className = 'toast'; }, 2500);
    }

    // ===== é”®ç›˜å¿«æ·é”® =====
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 's') {
        e.preventDefault();
        saveArticle();
      }
    });

    // ===== åˆå§‹åŒ– =====
    loadArticles();
    renderSidebar();

    // åˆ é™¤æŒ‰é’®ï¼šç”¨äº‹ä»¶å§”æ‰˜åœ¨ document ä¸Šç›‘å¬ï¼Œé¿å…è¢«é®æŒ¡ã€ç„¦ç‚¹æˆ–å­å…ƒç´ æ‹¦æˆª
    document.addEventListener('click', function(e) {
      var btn = e.target.closest ? e.target.closest('#btn-delete') : (e.target.id === 'btn-delete' ? e.target : null);
      if (!btn) return;
      e.preventDefault();
      e.stopPropagation();
      deleteArticle();
    });
  </script>
</body>
</html>
