<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–‡ç«  - ä¸ªäººåšå®¢</title>
  <meta name="description" content="">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Serif+SC:wght@400;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- Page Loader -->
  <div class="page-loader">
    <div class="loader-dot"></div>
    <div class="loader-dot"></div>
    <div class="loader-dot"></div>
  </div>

  <!-- Navigation -->
  <nav class="nav">
    <div class="nav__inner">
      <a href="index.html" class="nav__logo">Blog.</a>
      <div class="nav__links">
        <a href="index.html" class="nav__link">é¦–é¡µ</a>
        <a href="blog.html" class="nav__link nav__link--active">åšå®¢</a>
        <a href="projects.html" class="nav__link">é¡¹ç›®</a>
        <a href="about.html" class="nav__link">å…³äº</a>
        <button class="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
      </div>
      <div class="nav__hamburger" aria-label="èœå•">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </nav>

  <!-- Mobile Menu -->
  <div class="mobile-menu">
    <a href="index.html">é¦–é¡µ</a>
    <a href="blog.html">åšå®¢</a>
    <a href="projects.html">é¡¹ç›®</a>
    <a href="about.html">å…³äº</a>
    <button class="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
  </div>

  <!-- Article Pageï¼ˆç”± JS è‡ªåŠ¨å¡«å……å†…å®¹ï¼‰ -->
  <article class="article-page">
    <div class="container container--narrow">
      <!-- Article Header -->
      <header class="article__header reveal">
        <p class="article__category" id="article-category"></p>
        <h1 class="article__title" id="article-title"></h1>
        <div class="article__meta" id="article-meta"></div>
        <div class="tags mt-3" style="justify-content: center;" id="article-tags"></div>
      </header>
    </div>

    <div class="container" style="max-width: 1100px;">
      <div class="article__layout">
        <!-- Article Content -->
        <div class="article__content prose reveal" id="article-content">
          <!-- æ–‡ç« æ­£æ–‡ç”± JavaScript è‡ªåŠ¨ä» data/articles.js è¯»å–å¹¶å¡«å…… -->
        </div>

        <!-- TOC Sidebar -->
        <aside class="toc">
          <h3 class="toc__title">ç›®å½•</h3>
          <nav class="toc__list">
            <!-- Populated by JavaScript -->
          </nav>
        </aside>
      </div>

      <!-- Article Navigation -->
      <div class="article-nav reveal" id="article-nav">
        <!-- ä¸Šä¸€ç¯‡/ä¸‹ä¸€ç¯‡ç”± JavaScript è‡ªåŠ¨ç”Ÿæˆ -->
      </div>

      <!-- Comments Section -->
      <div class="comments-section reveal">
        <h2 class="comments-title">è¯„è®º</h2>

        <!-- Comments List -->
        <div id="comments-list">
          <p class="comments-loading">åŠ è½½è¯„è®ºä¸­...</p>
        </div>

        <!-- Comment Form -->
        <div class="comment-form-wrap">
          <h3 class="comment-form__title">å‘è¡¨è¯„è®º</h3>
          <form id="comment-form" onsubmit="submitComment(event)">
            <div class="comment-form__row">
              <input type="text" id="comment-name" placeholder="ä½ çš„åå­— *" required class="comment-input">
              <input type="email" id="comment-email" placeholder="é‚®ç®±ï¼ˆé€‰å¡«ï¼‰" class="comment-input">
            </div>
            <textarea id="comment-content" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." required class="comment-textarea"></textarea>
            <button type="submit" class="comment-submit">æäº¤è¯„è®º</button>
          </form>
          <p id="comment-msg" class="comment-msg"></p>
        </div>
      </div>
    </div>
  </article>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer__inner">
        <p class="footer__text">&copy; 2025 Blog. All rights reserved.</p>
        <div class="footer__links">
          <a href="index.html" class="footer__link">é¦–é¡µ</a>
          <a href="blog.html" class="footer__link">åšå®¢</a>
          <a href="projects.html" class="footer__link">é¡¹ç›®</a>
          <a href="about.html" class="footer__link">å…³äº</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Back to Top -->
  <button class="back-to-top" aria-label="è¿”å›é¡¶éƒ¨">&uarr;</button>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="js/supabase.js"></script>
  <script src="js/api.js"></script>
  <script src="js/main.js"></script>

  <script>
    // è¯„è®ºåŠŸèƒ½
    (function() {
      const params = new URLSearchParams(window.location.search);
      const articleId = parseInt(params.get('id'));

      // åŠ è½½è¯„è®º
      async function loadComments() {
        const listEl = document.getElementById('comments-list');
        if (!listEl || !articleId) return;
        try {
          const comments = await CommentsAPI.getApproved(articleId);
          if (!comments.length) {
            listEl.innerHTML = '<p class="comments-empty">æš‚æ— è¯„è®ºï¼Œæ¥å‘è¡¨ç¬¬ä¸€æ¡å§ï¼</p>';
            return;
          }
          listEl.innerHTML = comments.map(c => `
            <div class="comment-item">
              <div class="comment-item__header">
                <span class="comment-item__author">${escapeHtml(c.author_name)}</span>
                <span class="comment-item__date">${new Date(c.created_at).toLocaleDateString('zh-CN')}</span>
              </div>
              <p class="comment-item__content">${escapeHtml(c.content)}</p>
            </div>
          `).join('');
        } catch (e) {
          listEl.innerHTML = '<p class="comments-empty">è¯„è®ºåŠ è½½å¤±è´¥</p>';
        }
      }

      // æäº¤è¯„è®º
      window.submitComment = async function(e) {
        e.preventDefault();
        const name = document.getElementById('comment-name').value.trim();
        const email = document.getElementById('comment-email').value.trim();
        const content = document.getElementById('comment-content').value.trim();
        const msgEl = document.getElementById('comment-msg');
        const btn = document.querySelector('.comment-submit');

        if (!name || !content) return;
        btn.disabled = true;
        btn.textContent = 'æäº¤ä¸­...';
        try {
          await CommentsAPI.submit(articleId, name, email, content);
          msgEl.textContent = 'è¯„è®ºå·²æäº¤ï¼Œå®¡æ ¸é€šè¿‡åå°†æ˜¾ç¤ºã€‚æ„Ÿè°¢å‚ä¸ï¼';
          msgEl.className = 'comment-msg comment-msg--success';
          document.getElementById('comment-form').reset();
        } catch (e) {
          msgEl.textContent = 'æäº¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚';
          msgEl.className = 'comment-msg comment-msg--error';
        } finally {
          btn.disabled = false;
          btn.textContent = 'æäº¤è¯„è®º';
        }
      };

      function escapeHtml(str) {
        return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      }

      document.addEventListener('DOMContentLoaded', loadComments);
    })();
  </script>
</body>
</html>
